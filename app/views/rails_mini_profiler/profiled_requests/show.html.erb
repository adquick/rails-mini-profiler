<section class="request-details">
  <h2> <%= @profiled_request.path %> </h2>

  <ul class="request-details-data">
    <li class="data-item">
      <small>Status</small>
      <span><%= @profiled_request.status %></span>
    </li>
    <li class="data-item">
      <small>Response Time</small>
      <span><%= @profiled_request.duration %>ms</span>
    </li>
    <li class="data-item">
      <small>Allocations</small>
      <span><%= @profiled_request.allocations %></span>
    </li>
  </ul>
</section>

<section class="response-details">
  <h1>Response Details</h1>
</section>

<section>
  <% traces = @profiled_request.traces %>
  <% steps = traces
    .map do |trace|
    OpenStruct.new(
      name: trace.name,
      type: trace.name,
      duration: trace.duration.round(2),
      percent: (trace.duration / @profiled_request.duration * 100).round(2),
      fromStart: ((trace.start - @profiled_request.start) * 1000).round(2),
      payload: trace.payload,
      backtrace: trace.backtrace,
      fromStartPercent: ((trace.start - @profiled_request.start) /
        (@profiled_request.finish - @profiled_request.start)) * 100
    )
  end
    total_time = steps.shift
  %>

  <span>Total Time <%= total_time.duration %></span>

  <table class="table pr-steps" style="">
    <thead>
    <tr>
      <th>Step</th>
      <th>Duration</th>
      <th>% of Total</th>
      <th>From Start</th>
    </tr>
    </thead>
    <tbody id="steps">
    <% steps.each do |step| %>
      <%= render "rails_mini_profiler/profiled_requests/shared/step", step: step %>
    <% end %>
    </tbody>
  </table>

</section>
